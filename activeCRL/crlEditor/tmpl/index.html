<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>CRL Editor</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
<!--  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">  -->
<link rel="stylesheet" href="/js/themes/joint.css">
<link rel="stylesheet" href="/js/jquery-ui-1.12.1.custom/jquery-ui.css">
<link rel="stylesheet" href="/js/themes/crlEditor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="/js/jquery-ui-1.12.1.custom/external/jquery/jquery.js"></script>
<script src="/js/jquery-ui-1.12.1.custom/jquery-ui.js"></script>
<script src="/js/lodash.js"></script>
<script src="/js/backbone.js"></script>
<script src="/js/joint.js"></script>
<script src="/js/joint.shapes.uml.js"></script>
<script src="/js/crlShapes.js"></script>
<script src="/js/jstree.js"></script>
<!--  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script> -->
<script src="/js/crlEditor.js"></script>
<script>
	$(function() {
		initializeEditor();
	});
</script>
<script type="text/javascript">
	function sizeAll() {
		// Body
		var bodyHeight = jQuery("body").height();
		var bodyWidth = jQuery("body").width();
//		console.log("Body width" + bodyWidth.toString());
		// Wrapper
		var wrapperMargin = jQuery("#wrapper").outerWidth(true) - jQuery("#wrapper").width();
		var wrapperWidth = bodyWidth - wrapperMargin;
		var wrapperHeight = bodyHeight - jQuery("#navbar").outerHeight(true) - wrapperMargin;
		jQuery("#wrapper").width(wrapperWidth);
		jQuery("#wrapper").height(wrapperHeight);
		// UofDBrowser
		var uOfDBrowserOuterWidth = jQuery("#uofd-browser").outerWidth(true);
		var uOfDBrowserMargin = uOfDBrowserOuterWidth - jQuery("#uofd-browser").width();
		var uOfDBrowserHeight = wrapperHeight - uOfDBrowserMargin;
		jQuery("#uofd-browser").height(uOfDBrowserHeight);
		// Bottom
		jQuery("#bottom").position({
			my: "left bottom",
			at: "right bottom",
			of: "#uofd-browser"
		});
		// Center Pane
		var centerPaneMargin = jQuery("center-pane").outerWidth(true) - jQuery("center-pane").width();
		var centerPaneWidth = wrapperWidth - uOfDBrowserOuterWidth - centerPaneMargin;
		jQuery("#center-pane").width(centerPaneWidth);
		var centerPaneHeight = wrapperHeight - centerPaneMargin;
		jQuery("#center-pane").height(centerPaneHeight);
		jQuery("#center-pane").position({
			my: "left top",
			at: "right top",
			of: "#uofd-browser"
		})
		
		// Top Pane
		var topPaneMargin = jQuery("#top-pane").outerWidth(true) - jQuery("#top-pane").width();
		jQuery("#top-pane").height(centerPaneHeight - jQuery("#bottom").outerHeight(true) - topPaneMargin);
		
		// Toolbar
		var toolbarOuterWidth = jQuery("#toolbar").outerWidth(true);
		var toolbarMargin = toolbarOuterWidth - jQuery("#toolbar").width();
		var toolbarHeight = jQuery("#top-pane").height() - toolbarMargin;
		jQuery("#toolbar").height(toolbarHeight);
		
		// Top Content
		var topContentMargin = jQuery("#top-content").outerWidth(true) - jQuery("#top-content").width();
		jQuery("#top-content").width(centerPaneWidth - toolbarOuterWidth - topContentMargin);
		topContentHeight = jQuery("#top-pane").height() - topContentMargin;
		jQuery("#top-caontent").height(topContentHeight);
		console.log("topContentMargin: " + topContentMargin.toString());
		console.log("topPaneHeight: " + jQuery("#top-pane").height());

		// crlDiagramContainer
		crlDiagramContainerHeight = topContentHeight - jQuery("#tabs").height();
		jQuery(".crlDiagramContainer").height(crlDiagramContainerHeight);
		console.log("topContentHeight: " + topContentHeight.toString());
		console.log("tabsHeight: " + jQuery("#tabs").height().toString());
		console.log("CrlDiagramContainerHeight: " + crlDiagramContainerHeight.toString());
	};
</script>
<script type="text/javascript">
	$(function() {
		$(".uofd-browser").resizable({
			handles : "e",
			resize: sizeAll()
		});
		$(".bottom").resizable({
			handles : "n",
			resize : sizeAll()
		});
	});
</script>

<script type="text/javascript">
	function openDiagramContainer(diagramContainerId) {
		var i;
		var x = document.getElementsByClassName("crlDiagramContainer");
		for (i = 0; i < x.length; i++) {
			if (x[i].id == diagramContainerId) {
				x[i].style.display = "block";
			} else {
				x[i].style.display = "none";
			}
		}
	}
</script>

<var foo> </var>
<script type="text/javascript">
	$(function() {
		var graph = new joint.dia.Graph;

		var paper = new joint.dia.Paper({
			el : $('#diagram'),
			/*			width : 800,
			 height : 800, */
			model : graph,
			gridSize : 1
		});

		var rect = new joint.shapes.basic.Rect({
			position : {
				x : 100,
				y : 30
			},
			size : {
				width : 100,
				height : 30
			},
			attrs : {
				rect : {
					fill : 'blue'
				},
				text : {
					text : 'my box',
					fill : 'white'
				}
			}
		});

		var rect2 = new joint.shapes.crl.BaseElement({
			position : {
				x : 300,
				y : 30
			},
			size : {
				width : 100,
				height : 30
			},
			name : `Foo`
		});

		foo = rect2

		var rect3 = new joint.shapes.uml.Class({
			position : {
				x : 500,
				y : 30
			},
			size : {
				width : 100,
				height : 30
			},
			name : `Bar`
		});

		var link = new joint.dia.Link({
			source : {
				id : rect.id
			},
			target : {
				id : rect2.id
			}
		});

		graph.addCells([ rect, rect2, rect3, link ]);
	});
</script>

</head>

<body onresize="sizeAll()" onload="sizeAll()" id="body">
	<div class="navbar" id="navbar">
		<div class="dropdown">
			<button class="dropbtn">
				File <i class="fa fa-caret-down"></i>
			</button>
			<div class="dropdown-content">
				<a onClick="DiagramManager.NewDiagram()">New Diagram</a>
			</div>
		</div>
		<div class="dropdown">
			<button class="dropbtn">
				Edit <i class="fa fa-caret-down"></i>
			</button>
		</div>
		<div class="dropdown">
			<button class="dropbtn">
				Help <i class="fa fa-caret-down"></i>
			</button>
		</div>
	</div>
	<div class="wrapper" id="wrapper">
		<div class="uofd-browser" id="uofd-browser">
			<a>Universe of Discourse</a>
			<div class="modelTree" id="uOfD"></div>
		</div>
		<div class="center-pane" id="center-pane">
			<div class="top-pane" id="top-pane">
				<div class="toolbar" id="toolbar">
					<button>Element</button>
				</div>
				<div class="top-content" id="top-content">
					<div id="tabs" class="w3-bar w3-black tabs">
						<button class="w3-bar-item w3-button" onClick="openDiagramContainer('home')">Home</button>
					</div>
					<div id="home" class="crlDiagramContainer">
						<div class="diagram" id="diagram"></div>
					</div>
				</div>
			</div>
			<div class="bottom" id="bottom">
					<table id="properties" class="table">
						<thead>
							<tr>
								<th>Property</th>
								<th>Value</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
			</div>
		</div>
	</div>


</body>
</html>